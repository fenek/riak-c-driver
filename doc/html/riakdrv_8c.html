<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>riak-c-driver: riakdrv.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>riakdrv.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;json/json_tokener.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="riakdrv_8h_source.html">riakdrv.h</a>&quot;</code><br/>
<code>#include &quot;riakproto/riakmessages.pb-c.h&quot;</code><br/>
<code>#include &quot;riakproto/riakcodes.h&quot;</code><br/>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbuffered__char.html">buffered_char</a></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ad73478538b7df19e22214b1817277274">riak_copy_error</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, RpbErrorResp *errorResp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function for copying error message from PB structure to <a class="el" href="structRIAK__CONN.html" title="Connection handle structure.">RIAK_CONN</a>.  <a href="#ad73478538b7df19e22214b1817277274"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#acc22345774338ad49b3139dc74e7e9e5">riak_init</a> (char *hostname, int pb_port, int curl_port, <a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create new handle.  <a href="#acc22345774338ad49b3139dc74e7e9e5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#a8f4c5101059d0894aecbbfbbd3db680d">riak_exec_op</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, <a class="el" href="structRIAK__OP.html">RIAK_OP</a> *command, <a class="el" href="structRIAK__OP.html">RIAK_OP</a> *result)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Executes Riak operation via Protocol Buffers socket and receives response.  <a href="#a8f4c5101059d0894aecbbfbbd3db680d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#a4afa67d57602fb8421d5e62a1fbafaf0">riak_ping</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pings Riak server.  <a href="#a4afa67d57602fb8421d5e62a1fbafaf0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#af9865799d076888929ec8f493b5ba849">riak_list_buckets</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, int *n_buckets)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fetches list of buckets.  <a href="#af9865799d076888929ec8f493b5ba849"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#a7ea389a183b9921ce31d4994a307ef67">readfunc</a> (void *ptr, size_t size, size_t nmemb, void *userdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function for cURL, reads data from buffer.  <a href="#a7ea389a183b9921ce31d4994a307ef67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ab9f8a870e233a2768ff1b6a4af3a7362">writefunc</a> (void *ptr, size_t size, size_t nmemb, void *userdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function for cURL, writes data to buffer.  <a href="#ab9f8a870e233a2768ff1b6a4af3a7362"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ad0615f1f92010db78712cd2a06ac5147">riak_put_json</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, char *bucket, char *key, json_object *elem)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">json_object **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#a6fc65357610dd512f9ebdba67d559e0d">riak_get_json_mapred</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, char *mapred_statement, int *ret_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">json_object **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ae5963885b42dac3fe0d840f20f38aebd">riak_get_json_rs</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, char *mapred_statement, int *ret_len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ab267dbfa3510535367f80bfcef4768f3">riak_get_raw_rs</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct, char *query)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#ac2cbf23402be266af0dbc121819276ca">riak_close</a> (<a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *connstruct)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Closes connection to Riak.  <a href="#ac2cbf23402be266af0dbc121819276ca"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="riakdrv_8c.html#a2251ba55279aef307357d4b82d7cffb7">first_time</a> = 1</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a7ea389a183b9921ce31d4994a307ef67"></a><!-- doxytag: member="riakdrv.c::readfunc" ref="a7ea389a183b9921ce31d4994a307ef67" args="(void *ptr, size_t size, size_t nmemb, void *userdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t readfunc </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>userdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function for cURL, reads data from buffer. </p>
<p>This is helper function for cURL, which takes userdata and ptr (internal field where cURL stores data to be sent) and then copies contents of userdata to ptr. This function assumes that userdata is of type struct <a class="el" href="structbuffered__char.html">buffered_char</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>internal cURL location </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>size of one data piece </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nmemb</em>&nbsp;</td><td>count of data pieces </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>userdata</em>&nbsp;</td><td>structure from which data should be read</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>amount of data copied </dd></dl>

</div>
</div>
<a class="anchor" id="ac2cbf23402be266af0dbc121819276ca"></a><!-- doxytag: member="riakdrv.c::riak_close" ref="ac2cbf23402be266af0dbc121819276ca" args="(RIAK_CONN *connstruct)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void riak_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Closes connection to Riak. </p>
<p>This function ends cURL session, closes TCP socket and frees connstruct, so this structure can't be used after calling this function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>connection structure to be closed and freed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad73478538b7df19e22214b1817277274"></a><!-- doxytag: member="riakdrv.c::riak_copy_error" ref="ad73478538b7df19e22214b1817277274" args="(RIAK_CONN *connstruct, RpbErrorResp *errorResp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void riak_copy_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">RpbErrorResp *&nbsp;</td>
          <td class="paramname"> <em>errorResp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function for copying error message from PB structure to <a class="el" href="structRIAK__CONN.html" title="Connection handle structure.">RIAK_CONN</a>. </p>
<p>Simple function that copies error description from RpbErrorResp to <a class="el" href="structRIAK__CONN.html" title="Connection handle structure.">RIAK_CONN</a> in such way, that <a class="el" href="structRIAK__CONN.html#a81357b1e5540c2347a8d10af43146647">RIAK_CONN.error_msg</a> is cleared (if not NULL) and then error message is allocated to it. Message has following format: "(&lt;Riak error code in hex&gt;): &lt;Riak error message&gt;".</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>Riak connection handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>errorResp</em>&nbsp;</td><td>Protocol Buffers structure containing Riak error response </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8f4c5101059d0894aecbbfbbd3db680d"></a><!-- doxytag: member="riakdrv.c::riak_exec_op" ref="a8f4c5101059d0894aecbbfbbd3db680d" args="(RIAK_CONN *connstruct, RIAK_OP *command, RIAK_OP *result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riak_exec_op </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structRIAK__OP.html">RIAK_OP</a> *&nbsp;</td>
          <td class="paramname"> <em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structRIAK__OP.html">RIAK_OP</a> *&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Executes Riak operation via Protocol Buffers socket and receives response. </p>
<p>This is universal function for executing Riak operations and receiving responses. It is a wrapper for socket operations. Ultimately, user shouldn't have to use this function because other functions are to cover all possible operations. Still, probably this function will remain in library API even then.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>connection handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>command</em>&nbsp;</td><td>command to be sent to Riak </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>structure for response; this function won't allocate space and won't check if result structure exists!</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if success, error code &gt; 0 when failure </dd></dl>

</div>
</div>
<a class="anchor" id="a6fc65357610dd512f9ebdba67d559e0d"></a><!-- doxytag: member="riakdrv.c::riak_get_json_mapred" ref="a6fc65357610dd512f9ebdba67d559e0d" args="(RIAK_CONN *connstruct, char *mapred_statement, int *ret_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">json_object** riak_get_json_mapred </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mapred_statement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>ret_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ae5963885b42dac3fe0d840f20f38aebd"></a><!-- doxytag: member="riakdrv.c::riak_get_json_rs" ref="ae5963885b42dac3fe0d840f20f38aebd" args="(RIAK_CONN *connstruct, char *mapred_statement, int *ret_len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">json_object** riak_get_json_rs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mapred_statement</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>ret_len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab267dbfa3510535367f80bfcef4768f3"></a><!-- doxytag: member="riakdrv.c::riak_get_raw_rs" ref="ab267dbfa3510535367f80bfcef4768f3" args="(RIAK_CONN *connstruct, char *query)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* riak_get_raw_rs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>query</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acc22345774338ad49b3139dc74e7e9e5"></a><!-- doxytag: member="riakdrv.c::riak_init" ref="acc22345774338ad49b3139dc74e7e9e5" args="(char *hostname, int pb_port, int curl_port, RIAK_CONN *connstruct)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> * riak_init </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>hostname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pb_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>curl_port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create new handle. </p>
<p>This function creates new Riak handle. It contains both TCP socket for operations using Protocol Buffers and CURL handle for operations like using Riak Search.</p>
<p>WARNING! If connstruct!=NULL, this function will assume that it doesn't describe open connection anyway, therefore will overwrite all values inside structure.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hostname</em>&nbsp;</td><td>string containing address where Riak server can be accessed, e.g. 127.0.0.1 </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pb_port</em>&nbsp;</td><td>port where Protocol Buffers API is available, e.g. 8087; may be 0, in such case PB operations won't be available </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>curl_port</em>&nbsp;</td><td>port where HTTP server is available, e.g. 8089; may be 0, in such case HTTP operations won't be available </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>structure for holding Riak connection data; when NULL - new structure will be allocated</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>handle to Riak connection; if connstruct != NULL, then connstruct is returned; returns NULL on error </dd></dl>

</div>
</div>
<a class="anchor" id="af9865799d076888929ec8f493b5ba849"></a><!-- doxytag: member="riakdrv.c::riak_list_buckets" ref="af9865799d076888929ec8f493b5ba849" args="(RIAK_CONN *connstruct, int *n_buckets)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ** riak_list_buckets </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>n_buckets</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fetches list of buckets. </p>
<p>This function sends list buckets request to Riak and returns array of null-terminated strings containing names of all buckets. This array is not managed later so user should take care of freeing it after usage!</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>connection handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>n_buckets</em>&nbsp;</td><td>pointer to integer, where bucket count will be written</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array (of n_buckets length) of null-terminated strings; NULL on error </dd></dl>

</div>
</div>
<a class="anchor" id="a4afa67d57602fb8421d5e62a1fbafaf0"></a><!-- doxytag: member="riakdrv.c::riak_ping" ref="a4afa67d57602fb8421d5e62a1fbafaf0" args="(RIAK_CONN *connstruct)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int riak_ping </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pings Riak server. </p>
<p>Sends ping request to Riak via Protocol Buffers.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connstruct</em>&nbsp;</td><td>connection handle</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if success, not 0 on error </dd></dl>

</div>
</div>
<a class="anchor" id="ad0615f1f92010db78712cd2a06ac5147"></a><!-- doxytag: member="riakdrv.c::riak_put_json" ref="ad0615f1f92010db78712cd2a06ac5147" args="(RIAK_CONN *connstruct, char *bucket, char *key, json_object *elem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void riak_put_json </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRIAK__CONN.html">RIAK_CONN</a> *&nbsp;</td>
          <td class="paramname"> <em>connstruct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">json_object *&nbsp;</td>
          <td class="paramname"> <em>elem</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ab9f8a870e233a2768ff1b6a4af3a7362"></a><!-- doxytag: member="riakdrv.c::writefunc" ref="ab9f8a870e233a2768ff1b6a4af3a7362" args="(void *ptr, size_t size, size_t nmemb, void *userdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t writefunc </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>userdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function for cURL, writes data to buffer. </p>
<p>This is helper function for cURL, which takes userdata and ptr (internal field where cURL stores data received) and then copies contents of ptr to userdata. This function assumes that userdata is of type struct <a class="el" href="structbuffered__char.html">buffered_char</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ptr</em>&nbsp;</td><td>internal cURL location </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>size of one data piece </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nmemb</em>&nbsp;</td><td>count of data pieces </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>userdata</em>&nbsp;</td><td>structure to which data should be read</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>amount of data copied </dd></dl>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a2251ba55279aef307357d4b82d7cffb7"></a><!-- doxytag: member="riakdrv.c::first_time" ref="a2251ba55279aef307357d4b82d7cffb7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="riakdrv_8c.html#a2251ba55279aef307357d4b82d7cffb7">first_time</a> = 1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Jan 19 2011 for riak-c-driver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
